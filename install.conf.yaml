- defaults:
    link:
      create: true
      relink: true

- clean: ['~']

- link:
    ~/.zshrc: .zshrc
    ~/.tmux.conf: .tmux.conf
    ~/.vimrc: .vimrc
    ~/.p10k.zsh: .p10k.zsh
    ~/.alacritty.yml: .alacritty.yml
    ~/.aerospace.toml: .aerospace.toml
    ~/.config: .config

- create:
    - ~/downloads
    - ~/.local/bin

- shell:
    - description: Install Homebrew
      command: |
        echo "Checking for Homebrew..."
        if ! command -v brew &> /dev/null; then
          echo "Homebrew not found, installing..."
          echo "This will require sudo access - you may be prompted for password"
          NONINTERACTIVE=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          echo "Homebrew installation completed, exit code: $?"
          # Add brew to PATH for this session
          eval "$(/opt/homebrew/bin/brew shellenv)" 2>/dev/null || eval "$(/usr/local/bin/brew shellenv)" 2>/dev/null
        else
          echo "Homebrew already installed at: $(which brew)"
        fi
    - description: Install packages and dependencies
      command: |
        echo "Checking brew availability..."
        which brew || echo "brew not in PATH"
        echo "Tapping homebrew/cask-fonts..."
        brew tap homebrew/cask-fonts
        echo "Installing CLI tools..."
        brew install coreutils curl fzf krew kubectx kubernetes-cli k9s helm nvim openssl screenfetch tfenv tldr tmux lsd yh yq fd rg jq node wget gh ollama
        echo "Installing GUI applications..."
        brew install --cask alacritty visual-studio-code slack podman-desktop obsidian font-meslo-lg-nerd-font aerospace arc karabiner-elements
        echo "Package installation completed"
    - description: Install oh-my-zsh
      command: |
        if [ ! -d "$HOME/.oh-my-zsh" ]; then
          sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
        fi
    - description: Install powerlevel10k theme
      command: |
        if [ ! -d "$HOME/.oh-my-zsh/custom/themes/powerlevel10k" ]; then
          git clone --depth=1 https://github.com/romkatv/powerlevel10k.git $HOME/.oh-my-zsh/custom/themes/powerlevel10k
        fi
    - description: Install zsh-syntax-highlighting plugin
      command: |
        if [ ! -d "$HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting" ]; then
          git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
        fi
    - description: Configure Neovim
      command: |
        if [ -d "$HOME/.config/nvim" ]; then
          mv ~/.config/nvim ~/.config/nvim.backup
        fi
        if [ -d "$HOME/.config/nvim.backup/lua/custom" ]; then
          cp -r ~/.config/nvim.backup/lua/custom ~/.config/nvim/lua
        fi
        nvim +PackerSync