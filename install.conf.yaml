- defaults:
    link:
      create: true
      relink: true
      force: true

- clean: ['~']

# Cross-platform links
- link:
    ~/.tmux.conf: .tmux.conf
    ~/.tmux.conf.local: .tmux.conf.local
    ~/.vimrc: .vimrc
    ~/.config: .config
    # Claude Code configs
    ~/.claude/CLAUDE.md: .claude/CLAUDE.md
    ~/.claude/settings.json: .claude/settings.json
    ~/.claude/hooks: .claude/hooks
    ~/.claude/ccline/config.toml: .claude/ccline/config.toml
    ~/.claude/skills/damage-control: .claude/skills/damage-control
    ~/.claude/skills/markmap-render: .claude/skills/markmap-render
    ~/.claude/agents: .claude/agents
    ~/.claude/templates: .claude/templates

# macOS-only links
- link:
    ~/.zshrc:
      path: .zshrc
      if: '[ "$(uname)" = "Darwin" ]'
    ~/.p10k.zsh:
      path: .p10k.zsh
      if: '[ "$(uname)" = "Darwin" ]'
    ~/.aerospace.toml:
      path: .aerospace.toml
      if: '[ "$(uname)" = "Darwin" ]'

- create:
    - ~/.local/bin
    - ~/.claude
    - ~/.claude/ccline
    - ~/.claude/skills

- shell:
    - description: Ensure sudo access for Homebrew installation
      command: |
        echo "Checking sudo access (required for Homebrew installation)..."
        sudo -v
        echo "Sudo access confirmed"
    - description: Install Homebrew
      command: |
        echo "Checking for Homebrew..."
        if ! command -v brew &> /dev/null; then
          echo "Homebrew not found, installing..."
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
          echo "Homebrew installation completed, exit code: $?"
          # Add brew to PATH for current session
          if [ "$(uname)" = "Darwin" ]; then
            export PATH="/opt/homebrew/bin:$PATH"
            echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
          else
            export PATH="/home/linuxbrew/.linuxbrew/bin:$PATH"
            echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> ~/.profile
          fi
        else
          echo "Homebrew already installed at: $(which brew)"
        fi
    - description: Install cross-platform CLI tools
      command: |
        echo "Installing cross-platform CLI tools..."
        brew install coreutils curl fzf krew kubectx kubernetes-cli k9s helm nvim openssl screenfetch tfenv tldr tmux lsd yh yq fd rg jq node wget gh ollama lazygit az uv
        echo "CLI tools installation completed"
    - description: Install ccline (Claude Code status line)
      command: |
        if ! command -v ccline &> /dev/null; then
          echo "Installing ccline..."
          npm install -g @cometix/ccline
          echo "ccline installation completed"
        else
          echo "ccline already installed at: $(which ccline)"
        fi
    - description: Install macOS GUI applications (skipped on Linux)
      command: |
        if [ "$(uname)" = "Darwin" ]; then
          echo "Installing macOS GUI applications..."
          brew tap nikitabobko/tap
          brew install --cask ghostty visual-studio-code slack podman-desktop obsidian font-meslo-lg-nerd-font arc karabiner-elements kaleidoscope
          brew install --cask nikitabobko/tap/aerospace
          echo "macOS GUI applications installation completed"
        else
          echo "Skipping macOS GUI applications on Linux"
        fi
    - description: Install oh-my-zsh (skipped on Linux)
      command: |
        if [ "$(uname)" = "Darwin" ]; then
          if [ ! -d "$HOME/.oh-my-zsh" ]; then
            sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
          fi
        else
          echo "Skipping oh-my-zsh on Linux"
        fi
    - description: Install powerlevel10k theme (skipped on Linux)
      command: |
        if [ "$(uname)" = "Darwin" ]; then
          if [ ! -d "$HOME/.oh-my-zsh/custom/themes/powerlevel10k" ]; then
            git clone --depth=1 https://github.com/romkatv/powerlevel10k.git $HOME/.oh-my-zsh/custom/themes/powerlevel10k
          fi
        else
          echo "Skipping powerlevel10k on Linux"
        fi
    - description: Install zsh-syntax-highlighting plugin (skipped on Linux)
      command: |
        if [ "$(uname)" = "Darwin" ]; then
          if [ ! -d "$HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting" ]; then
            git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $HOME/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
          fi
        else
          echo "Skipping zsh-syntax-highlighting on Linux"
        fi
    - description: Configure Neovim with LazyVim
      command: |
        echo "LazyVim will auto-install plugins on first startup"
        echo "Run 'nvim' to complete the setup"
